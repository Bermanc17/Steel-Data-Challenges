--1. What are the details of all cars purchased in the year 2022?
select distinct cars.*
from PortfolioProject.dbo.sales
join PortfolioProject.dbo.cars
	on sales.car_id = cars.car_id
where purchase_date like '%2022%'
order by cars.car_id;

--2. What is the total number of cars sold by each salesperson?
select distinct salespersons.name, count(*) over (partition by salespersons.name order by salespersons.salesman_id) as "sales per person"
from PortfolioProject.dbo.sales
join PortfolioProject.dbo.cars
	on sales.car_id = cars.car_id
inner join PortfolioProject.dbo.salespersons
	on sales.salesman_id = salespersons.salesman_id;

--3. What is the total revenue generated by each salesperson?
select distinct salespersons.name, sum(cars.cost_$) over (partition by salespersons.name order by salespersons.salesman_id) as "Total revenue per person"
from PortfolioProject.dbo.sales
join PortfolioProject.dbo.cars
	on sales.car_id = cars.car_id
inner join PortfolioProject.dbo.salespersons
	on sales.salesman_id = salespersons.salesman_id;

--4. What are the details of the cars sold by each salesperson?
select salespersons.name, cars.*
from PortfolioProject.dbo.sales
join PortfolioProject.dbo.cars
	on sales.car_id = cars.car_id
inner join PortfolioProject.dbo.salespersons
	on sales.salesman_id = salespersons.salesman_id
order by salespersons.name;

--5. What is the total revenue generated by each car type?
select distinct cars.type, sum(cars.cost_$) over (partition by salespersons.name order by salespersons.salesman_id) as "Total revenue per car type"
from PortfolioProject.dbo.cars
inner join PortfolioProject.dbo.sales
	on cars.car_id = sales.car_id
inner join PortfolioProject.dbo.salespersons
	on sales.car_id = salespersons.salesman_id
order by  'Total revenue per car type' DESC;

--6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?
select  cars.*
from PortfolioProject.dbo.cars cars 
inner join PortfolioProject.dbo.sales sales
	on cars.car_id = sales.car_id
inner join PortfolioProject.dbo.salespersons salespersons
	on cars.car_id = salespersons.salesman_id
where year(sales.purchase_date)=2021 and salespersons.name ='Emily Wong';

--7. What is the total revenue generated by the sales of hatchback cars?
select  distinct cars.style, sum(cars.cost_$) over (partition by salespersons.name order by salespersons.salesman_id) as "total Revenue by Hatchback"
from PortfolioProject.dbo.cars cars 
inner join PortfolioProject.dbo.sales sales
	on cars.car_id = sales.car_id
inner join PortfolioProject.dbo.salespersons salespersons
	on cars.car_id = salespersons.salesman_id
where cars.style = 'Hatchback';

--8. What is the total revenue generated by the sales of SUV cars in the year 2022?
select  cars.style, sum(cars.cost_$) over (partition by cars.style) as "total Revenue by SUV"
from PortfolioProject.dbo.cars cars 
inner join PortfolioProject.dbo.sales sales
	on cars.car_id = sales.car_id
where cars.style = 'SUV' and year(sales.purchase_date) =2022;

--9. What is the name and city of the salesperson who sold the most number of cars in the year 2023?
select  salespersons.name,salespersons.city, count(sales.car_id) as "Top Salesperson for 2023"
from sales
join salespersons
	on sales.salesman_id = salespersons.salesman_id
where YEAR(sales.purchase_date) = 2023
Group by salespersons.name, salespersons.city
order by COUNT(sales.car_id) DESC;

--10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?
select  salespersons.name,salespersons.age, sum(cars.cost_$) as "Highest Revenue for 2022"
from sales
inner join cars
	on sales.car_id = cars.car_id
inner join PortfolioProject.dbo.salespersons salespersons
	on sales.salesman_id = salespersons.salesman_id
where YEAR(sales.purchase_date) = 2022
Group by salespersons.name, salespersons.age
order by COUNT(cars.cost_$) DESC;
